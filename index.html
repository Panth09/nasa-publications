<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üöÄ</text></svg>">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NASA Publications Analysis</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e3a8a 50%, #0f172a 100%);
            color: #ffffff;
            min-height: 100vh;
            transition: background 0.3s, color 0.3s;
        }

        body.light-mode {
            background: linear-gradient(135deg, #e0e7ff 0%, #c7d2fe 50%, #e0e7ff 100%);
            color: #1f2937;
        }

        .header {
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            position: sticky;
            top: 0;
            z-index: 50;
        }

        .header-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 16px 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 16px;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .header-icon {
            font-size: 40px;
        }

        .header-title {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .header-subtitle {
            font-size: 13px;
            color: #93c5fd;
        }

        .header-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
        }

        .btn-primary {
            background: #3b82f6;
            color: white;
        }

        .btn-primary:hover {
            background: #2563eb;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .btn-purple {
            background: #9333ea;
            color: white;
        }

        .btn-purple:hover {
            background: #7e22ce;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 32px 24px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 24px;
            transition: all 0.3s;
        }

        .stat-card:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
        }

        .stat-icon {
            font-size: 20px;
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 36px;
            font-weight: 700;
            line-height: 1;
        }

        .filters-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
        }

        .filters-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .filters-header h3 {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 16px;
            font-weight: 600;
        }

        .search-wrapper {
            position: relative;
            margin-bottom: 16px;
        }

        .search-icon {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: rgba(255, 255, 255, 0.6);
            font-size: 18px;
        }

        .search-box {
            width: 100%;
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            padding: 14px 20px 14px 45px;
            color: white;
            font-size: 15px;
            transition: all 0.2s;
        }

        .search-box:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.2);
            border-color: #3b82f6;
        }

        .search-box::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 16px;
        }

        .filter-select {
            width: 100%;
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            padding: 10px 14px;
            color: white;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .filter-select:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.2);
            border-color: #3b82f6;
        }

        .filter-select option {
            background: #1e3a8a;
            color: white;
        }

        .advanced-filters {
            display: none;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            padding-top: 16px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            margin-top: 16px;
        }

        .advanced-filters.active {
            display: grid;
        }

        .filters-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }

        .results-count {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.7);
        }

        .view-toggle {
            display: flex;
            gap: 8px;
        }

        .view-btn {
            padding: 6px 12px;
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
        }

        .view-btn.active {
            background: #3b82f6;
            border-color: #3b82f6;
        }

        .publications-list {
            display: grid;
            gap: 20px;
        }

        .pub-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 24px;
            transition: all 0.3s;
        }

        .pub-card:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(59, 130, 246, 0.5);
        }

        .pub-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 16px;
        }

        .pub-badges {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 12px;
        }

        .badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }

        .badge-high { background: rgba(34, 197, 94, 0.2); color: #86efac; }
        .badge-medium { background: rgba(251, 146, 60, 0.2); color: #fdba74; }
        .badge-low { background: rgba(156, 163, 175, 0.2); color: #d1d5db; }

        .pub-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 12px;
            line-height: 1.3;
        }

        .pub-abstract {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.6;
            margin-bottom: 16px;
        }

        .pub-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
            align-items: center;
            font-size: 13px;
            color: rgba(255, 255, 255, 0.7);
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .systems-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 12px;
        }

        .system-tag {
            padding: 6px 12px;
            background: rgba(168, 85, 247, 0.2);
            border: 1px solid rgba(168, 85, 247, 0.5);
            border-radius: 12px;
            font-size: 11px;
        }

        .expand-btn {
            padding: 8px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .expand-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .pub-details {
            display: none;
            margin-top: 24px;
            padding-top: 24px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }

        .pub-details.active {
            display: block;
        }

        .findings-section {
            margin-bottom: 24px;
        }

        .findings-section h4 {
            font-size: 16px;
            font-weight: 600;
            color: #93c5fd;
            margin-bottom: 12px;
        }

        .findings-list {
            list-style: none;
            padding: 0;
        }

        .findings-list li {
            display: flex;
            gap: 12px;
            margin-bottom: 12px;
            color: rgba(255, 255, 255, 0.9);
            line-height: 1.6;
        }

        .finding-number {
            color: #3b82f6;
            font-weight: 700;
            flex-shrink: 0;
        }

        .ai-analysis {
            margin-bottom: 24px;
        }

        .ai-analysis h4 {
            font-size: 16px;
            font-weight: 600;
            color: #86efac;
            margin-bottom: 12px;
        }

        .ai-content {
            color: rgba(255, 255, 255, 0.9);
            line-height: 1.8;
        }

        .domains-section {
            margin-bottom: 24px;
        }

        .domains-section h4 {
            font-size: 16px;
            font-weight: 600;
            color: #fbbf24;
            margin-bottom: 12px;
        }

        .domain-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .domain-tag {
            padding: 6px 12px;
            background: rgba(251, 191, 36, 0.2);
            border: 1px solid rgba(251, 191, 36, 0.5);
            border-radius: 8px;
            font-size: 13px;
        }

        .loading {
            text-align: center;
            padding: 60px 20px;
        }

        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.2);
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .no-results {
            text-align: center;
            padding: 60px 20px;
            color: rgba(255, 255, 255, 0.7);
        }

        .no-results-icon {
            font-size: 64px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .footer {
            margin-top: 60px;
            padding: 40px 20px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            backdrop-filter: blur(10px);
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
        }

        .footer-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 24px;
        }

        .footer-title {
            font-size: 24px;
            font-weight: 700;
            text-align: center;
        }

        .footer-developers {
            display: flex;
            gap: 24px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .developer-card {
            display: flex;
            align-items: center;
            gap: 16px;
            background: rgba(255, 255, 255, 0.05);
            padding: 16px 24px;
            border-radius: 12px;
            text-decoration: none;
            color: inherit;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.2s ease-out;
            transform-style: preserve-3d;
        }

        .developer-card:hover {
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
        }

        .linkedin-icon {
            width: 40px;
            height: 40px;
            background: #0077b5;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 22px;
            transform: translateZ(20px);
        }

        .developer-card:hover .linkedin-icon {
            animation: bounceIcon 0.6s ease-in-out;
        }

        @keyframes bounceIcon {
            0%, 100% { transform: translateZ(20px) scale(1); }
            50% { transform: translateZ(20px) scale(1.2); }
        }

        .developer-info {
            transform: translateZ(20px);
        }

        .developer-name {
            font-weight: 600;
            font-size: 18px;
        }

        .developer-role {
            font-size: 14px;
            opacity: 0.7;
        }

        .footer-copyright {
            font-size: 13px;
            opacity: 0.6;
            text-align: center;
        }

        @media (max-width: 768px) {
            .header-container {
                flex-direction: column;
                align-items: flex-start;
            }

            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }

            .filters-grid, .advanced-filters {
                grid-template-columns: 1fr;
            }

            .header-title {
                font-size: 24px;
            }
        }

        body.light-mode .header {
            background: rgba(255, 255, 255, 0.9);
            border-bottom-color: rgba(99, 102, 241, 0.2);
        }

        body.light-mode .stat-card,
        body.light-mode .filters-section,
        body.light-mode .pub-card {
            background: rgba(255, 255, 255, 0.9);
            border-color: rgba(99, 102, 241, 0.2);
        }

        body.light-mode .search-box,
        body.light-mode .filter-select {
            background: rgba(99, 102, 241, 0.1);
            border-color: rgba(99, 102, 241, 0.3);
            color: #1f2937;
        }

        body.light-mode .pub-title {
            color: #3b82f6;
        }

        body.light-mode .pub-abstract {
            color: #4b5563;
        }

        body.light-mode .stat-label,
        body.light-mode .pub-meta,
        body.light-mode .results-count {
            color: #6b7280;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-container">
            <div class="header-left">
                <div class="header-icon">üöÄ</div>
                <div>
                    <div class="header-title">NASA Publications Analysis</div>
                    <div class="header-subtitle">Space Biology Research Intelligence Platform</div>
                </div>
            </div>
            <div class="header-actions">
                <button class="btn btn-purple" onclick="exportData()">
                    <span>üì•</span>
                    Export
                </button>
                <button class="btn btn-primary" id="processBtn" onclick="triggerProcessing()">
                    <span>üîÑ</span>
                    Process New Data
                </button>
                <button class="btn btn-secondary" onclick="toggleTheme()">
                    <span id="themeIcon">üåô</span>
                    Theme
                </button>
            </div>
        </div>
    </div>

    <div class="container">
        <div id="loadingState" class="loading">
            <div class="spinner"></div>
            <div>Loading publications from Supabase...</div>
        </div>

        <div id="mainContent" style="display: none;">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">üìö</div>
                    <div class="stat-label">Total Publications</div>
                    <div class="stat-value" id="totalPubs">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚≠ê</div>
                    <div class="stat-label">High Relevance</div>
                    <div class="stat-value" id="highRelevance">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üß†</div>
                    <div class="stat-label">Avg Complexity</div>
                    <div class="stat-value" id="avgComplexity">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üèÜ</div>
                    <div class="stat-label">Total Findings</div>
                    <div class="stat-value" id="totalFindings">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üß™</div>
                    <div class="stat-label">Avg Duration</div>
                    <div class="stat-value" id="avgDuration">0<span style="font-size: 18px;">d</span></div>
                </div>
            </div>

            <div class="filters-section">
                <div class="filters-header">
                    <h3><span>üéØ</span> Filters</h3>
                    <button class="btn btn-secondary" style="padding: 6px 12px; font-size: 13px;" onclick="toggleAdvancedFilters()">
                        <span id="advancedToggleText">Show Advanced</span>
                    </button>
                </div>

                <div class="search-wrapper">
                    <span class="search-icon">üîç</span>
                    <input type="text" class="search-box" id="searchInput" placeholder="Search publications..." oninput="debouncedFilter()">
                </div>

                <div class="filters-grid">
                    <select class="filter-select" id="relevanceFilter" onchange="filterPublications()">
                        <option value="all">All Relevance</option>
                        <option value="high">High</option>
                        <option value="medium">Medium</option>
                        <option value="low">Low</option>
                    </select>

                    <select class="filter-select" id="systemFilter" onchange="filterPublications()">
                        <option value="all">All Systems</option>
                    </select>

                    <select class="filter-select" id="sortFilter" onchange="filterPublications()">
                        <option value="relevance">Sort by Relevance</option>
                        <option value="complexity">Sort by Complexity</option>
                        <option value="year">Sort by Year</option>
                        <option value="duration">Sort by Duration</option>
                    </select>
                </div>

                <div class="advanced-filters" id="advancedFilters">
                    <select class="filter-select" id="domainFilter" onchange="filterPublications()">
                        <option value="all">All Research Domains</option>
                    </select>

                    <select class="filter-select" id="yearFilter" onchange="filterPublications()">
                        <option value="all">All Years</option>
                    </select>

                    <select class="filter-select" id="durationFilter" onchange="filterPublications()">
                        <option value="all">All Durations</option>
                        <option value="short">Short (‚â§30 days)</option>
                        <option value="medium">Medium (31-90 days)</option>
                        <option value="long">Long (>90 days)</option>
                    </select>
                </div>

                <div class="filters-footer">
                    <div class="results-count">
                        Showing <strong id="resultsCount">0</strong> of <strong id="totalCount">0</strong> publications
                    </div>
                    <div class="view-toggle">
                        <button class="view-btn active" onclick="setViewMode('cards')">Cards</button>
                        <button class="view-btn" onclick="setViewMode('table')">Table</button>
                    </div>
                </div>
            </div>

            <div class="publications-list" id="publicationsList"></div>

            <div class="footer">
                <div class="footer-content">
                    <h2 class="footer-title">Meet the Developers</h2>
                    <div class="footer-developers">
                        <a href="https://www.linkedin.com/in/panthmaheshwari/" target="_blank" rel="noopener noreferrer" class="developer-card">
                            <div class="linkedin-icon">in</div>
                            <div class="developer-info">
                                <div class="developer-name">Panth Maheshwari</div>
                                <div class="developer-role">Full Stack Developer</div>
                            </div>
                        </a>
                        <a href="https://www.linkedin.com/in/rdvraval19/" target="_blank" rel="noopener noreferrer" class="developer-card">
                            <div class="linkedin-icon">in</div>
                            <div class="developer-info">
                                <div class="developer-name">Dipak Raval</div>
                                <div class="developer-role">Full Stack Developer</div>
                            </div>
                        </a>
                    </div>
                    <div class="footer-copyright">NASA Bioscience Research Explorer ¬© 2025</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const SUPABASE_URL = 'https://mciamxduiualbkslqfjb.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1jaWFteGR1aXVhbGJrc2xxZmpiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE3OTg5MDcsImV4cCI6MjA3NzM3NDkwN30.4Q3LWEMh5oS6EA4nX5QSIWQiOnnjtPrAWgQwBx-L7rU';
        const N8N_WEBHOOK_URL = 'http://localhost:5678/webhook-test/process';

        let allPublications = [];
        let filteredPublications = [];
        let debounceTimer;
        let processing = false;

        // Automatically load demo data if Supabase fails
        const USE_DEMO_MODE = true; // Set to false when Supabase is working

        // Test connection function
        async function testConnection() {
            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/`, {
                    method: 'GET',
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
                    }
                });
                console.log('Connection test:', response.status, response.statusText);
                return response.ok;
            } catch (error) {
                console.error('Connection test failed:', error);
                return false;
            }
        }

        // Demo data for testing
        function loadDemoData() {
            console.log('Loading demo data...');
            
            // Show loading briefly for smooth transition
            document.getElementById('loadingState').style.display = 'block';
            document.getElementById('loadingState').innerHTML = `
                <div class="spinner"></div>
                <div>Loading demo publications...</div>
            `;
            
            setTimeout(() => {
                allPublications = [
                    {
                        id: 'demo1',
                        pmcid: 'PMC8901234',
                        title: 'Effects of Microgravity on Immune System Function During Long-Duration Spaceflight',
                        abstract: 'This comprehensive study investigates the impact of prolonged exposure to microgravity on astronaut immune system function during extended missions aboard the International Space Station. We examined T-cell activation, cytokine production, NK cell function, and overall immune response in crew members during 6-month missions. Blood samples were collected pre-flight, in-flight at multiple time points, and post-flight. Results indicate significant alterations in immune cell signaling pathways, with a marked decrease in T-cell activation and changes in cytokine production patterns. These findings have critical implications for long-duration space missions and the development of countermeasures to maintain crew health.',
                        mission_relevance: 'high',
                        space_complexity: 8,
                        publication_year: 2023,
                        experiment_duration_days: 180,
                        findings_count: 5,
                        citations_count: 42,
                        relevance_score: 95,
                        biological_systems: JSON.stringify(['Immune System', 'Lymphatic System', 'Hematologic System']),
                        research_domains: JSON.stringify(['immunology', 'space_medicine', 'cellular_biology', 'physiology']),
                        key_findings: JSON.stringify([
                            'T-cell activation decreased by 35% after 90 days in microgravity environment',
                            'Cytokine production patterns showed significant alterations, particularly IL-2 and IFN-gamma',
                            'NK cell function remained relatively stable throughout the mission duration',
                            'Immune system recovery took 6-8 weeks post-flight with significant individual variation',
                            'Countermeasures including exercise and nutritional interventions showed partial mitigation of effects'
                        ]),
                        ai_response: '**Key Insights**: This research provides critical data for planning long-duration space missions beyond low Earth orbit. The 35% decrease in T-cell activation represents a significant immunological challenge.\n\n**Clinical Significance**: Understanding immune dysfunction is essential for crew health management on Mars missions. The extended recovery period post-flight suggests need for enhanced medical monitoring.\n\n**Recommendations**: Development of targeted countermeasures, enhanced monitoring protocols, and consideration of immune-boosting interventions for future deep space missions.',
                        link: 'https://www.ncbi.nlm.nih.gov/pmc/',
                        created_at: new Date().toISOString()
                    },
                    {
                        id: 'demo2',
                        pmcid: 'PMC8905678',
                        title: 'Bone Density Changes in Astronauts: A Comprehensive 12-Month Analysis of Skeletal Adaptation',
                        abstract: 'Bone loss remains one of the most critical challenges for long-duration spaceflight and planetary missions. This comprehensive longitudinal study analyzed bone mineral density changes, bone turnover markers, and skeletal adaptation in 50 astronauts over missions ranging from 3 to 12 months. Using advanced DEXA scanning and biomarker analysis, we tracked changes in trabecular and cortical bone at multiple skeletal sites. The research included analysis of exercise protocols, nutritional interventions, and pharmaceutical countermeasures.',
                        mission_relevance: 'high',
                        space_complexity: 7,
                        publication_year: 2024,
                        experiment_duration_days: 365,
                        findings_count: 4,
                        citations_count: 38,
                        relevance_score: 92,
                        biological_systems: JSON.stringify(['Skeletal System', 'Muscular System', 'Endocrine System']),
                        research_domains: JSON.stringify(['bone_biology', 'space_medicine', 'physiology', 'biomechanics']),
                        key_findings: JSON.stringify([
                            'Average bone loss of 1.5% per month observed in weight-bearing bones during spaceflight',
                            'Hip and lumbar spine identified as most affected skeletal regions with up to 18% total loss',
                            'Resistance exercise protocols using ARED equipment reduced bone loss by approximately 40%',
                            'Bisphosphonate treatment combined with exercise showed most promising results for bone preservation'
                        ]),
                        ai_response: '**Major Finding**: Bone loss rates were higher than previously estimated, with significant implications for mission planning.\n\n**Impact**: These findings are critical for missions beyond low Earth orbit where medical return is not feasible.\n\n**Future Research**: Need for improved countermeasures and potential pharmaceutical interventions for Mars missions.',
                        link: 'https://www.ncbi.nlm.nih.gov/pmc/',
                        created_at: new Date().toISOString()
                    },
                    {
                        id: 'demo3',
                        pmcid: 'PMC8909012',
                        title: 'Cardiovascular Adaptation to Microgravity Environment: Mechanisms and Countermeasures',
                        abstract: 'The cardiovascular system undergoes significant structural and functional adaptations during spaceflight due to fluid shifts, reduced orthostatic stress, and altered hemodynamics. This study monitored cardiac function, blood pressure regulation, vascular changes, and autonomic nervous system activity in astronauts during and after spaceflight missions. We utilized echocardiography, continuous blood pressure monitoring, and advanced imaging techniques to assess cardiovascular changes.',
                        mission_relevance: 'medium',
                        space_complexity: 6,
                        publication_year: 2023,
                        experiment_duration_days: 120,
                        findings_count: 3,
                        citations_count: 25,
                        relevance_score: 78,
                        biological_systems: JSON.stringify(['Cardiovascular System', 'Circulatory System']),
                        research_domains: JSON.stringify(['cardiology', 'space_medicine', 'physiology', 'biomechanics']),
                        key_findings: JSON.stringify([
                            'Cardiac output decreased by 10-15% after initial fluid shifts to upper body',
                            'Orthostatic intolerance observed in 60% of crew members upon return to Earth',
                            'Arterial stiffness increased during spaceflight missions, particularly in longer durations'
                        ]),
                        ai_response: '**Cardiovascular Changes**: Significant adaptations occur rapidly during spaceflight transition.\n\n**Clinical Considerations**: Orthostatic intolerance poses risks for emergency situations post-landing.\n\n**Countermeasures**: Lower body negative pressure training shows promise for maintaining cardiovascular function.',
                        link: 'https://www.ncbi.nlm.nih.gov/pmc/',
                        created_at: new Date().toISOString()
                    },
                    {
                        id: 'demo4',
                        pmcid: 'PMC8912345',
                        title: 'Neurological Changes and Cognitive Performance During Extended Spaceflight Missions',
                        abstract: 'Extended exposure to the space environment presents unique challenges to the central nervous system. This study examined cognitive performance, brain structure changes, and neurological function in astronauts during long-duration missions. Using pre-flight and post-flight MRI imaging, cognitive testing batteries, and real-time performance monitoring, we assessed multiple aspects of neurological health.',
                        mission_relevance: 'high',
                        space_complexity: 9,
                        publication_year: 2024,
                        experiment_duration_days: 200,
                        findings_count: 6,
                        citations_count: 51,
                        relevance_score: 88,
                        biological_systems: JSON.stringify(['Nervous System', 'Sensory System']),
                        research_domains: JSON.stringify(['neuroscience', 'cognitive_science', 'space_medicine']),
                        key_findings: JSON.stringify([
                            'Mild ventricular expansion observed in 75% of crew members on long-duration missions',
                            'Cognitive performance remained stable for most tasks with practice effects',
                            'Spatial orientation challenges increased during first 30 days of adaptation',
                            'Sleep quality decreased significantly impacting cognitive function',
                            'Visual acuity changes observed in 30% of crew members',
                            'Post-flight recovery of brain structure changes took 6-12 months'
                        ]),
                        link: 'https://www.ncbi.nlm.nih.gov/pmc/',
                        created_at: new Date().toISOString()
                    },
                    {
                        id: 'demo5',
                        pmcid: 'PMC8915678',
                        title: 'Muscle Atrophy and Protein Metabolism in Microgravity: Molecular Mechanisms',
                        abstract: 'Muscle loss is a significant concern for spaceflight missions. This molecular biology study investigated the mechanisms of muscle atrophy, protein synthesis rates, and metabolic changes in astronauts during spaceflight. We analyzed muscle biopsies, blood markers, and gene expression profiles.',
                        mission_relevance: 'high',
                        space_complexity: 7,
                        publication_year: 2023,
                        experiment_duration_days: 150,
                        findings_count: 5,
                        citations_count: 33,
                        relevance_score: 85,
                        biological_systems: JSON.stringify(['Muscular System', 'Metabolic System']),
                        research_domains: JSON.stringify(['molecular_biology', 'space_medicine', 'physiology']),
                        key_findings: JSON.stringify([
                            'Muscle volume decreased by 10-15% despite exercise countermeasures',
                            'Protein synthesis rates were suppressed by approximately 30%',
                            'Specific molecular pathways (mTOR, AMPK) showed dysregulation',
                            'Type II muscle fibers more affected than Type I',
                            'Nutritional protein supplementation showed modest protective effects'
                        ]),
                        link: 'https://www.ncbi.nlm.nih.gov/pmc/',
                        created_at: new Date().toISOString()
                    },
                    {
                        id: 'demo6',
                        pmcid: 'PMC8918901',
                        title: 'Radiation Exposure and DNA Damage During Space Missions: Risk Assessment',
                        abstract: 'Space radiation represents a unique hazard for astronauts on long-duration missions. This study quantified radiation exposure, assessed DNA damage markers, and evaluated cancer risk in crew members exposed to galactic cosmic rays and solar particle events.',
                        mission_relevance: 'high',
                        space_complexity: 8,
                        publication_year: 2024,
                        experiment_duration_days: 180,
                        findings_count: 4,
                        citations_count: 45,
                        relevance_score: 90,
                        biological_systems: JSON.stringify(['Cellular System', 'Immune System']),
                        research_domains: JSON.stringify(['radiation_biology', 'genomics', 'space_medicine']),
                        key_findings: JSON.stringify([
                            'Cumulative radiation dose averaged 150-200 mSv for 6-month ISS missions',
                            'Chromosomal aberrations increased by 40% during spaceflight',
                            'DNA repair mechanisms showed adaptations over mission duration',
                            'Long-term cancer risk estimated at 3-5% increase for extended missions'
                        ]),
                        link: 'https://www.ncbi.nlm.nih.gov/pmc/',
                        created_at: new Date().toISOString()
                    },
                    {
                        id: 'demo7',
                        pmcid: 'PMC8921234',
                        title: 'Ocular Changes and Visual System Adaptations in Astronauts',
                        abstract: 'Spaceflight-associated neuro-ocular syndrome (SANS) affects a significant proportion of astronauts. This ophthalmological study examined structural and functional changes in the visual system during and after spaceflight.',
                        mission_relevance: 'medium',
                        space_complexity: 6,
                        publication_year: 2023,
                        experiment_duration_days: 90,
                        findings_count: 4,
                        citations_count: 28,
                        relevance_score: 72,
                        biological_systems: JSON.stringify(['Sensory System', 'Nervous System']),
                        research_domains: JSON.stringify(['ophthalmology', 'neuroscience', 'space_medicine']),
                        key_findings: JSON.stringify([
                            'Optic disc edema observed in 40% of crew members',
                            'Globe flattening and choroidal folds detected via imaging',
                            'Hyperopic shifts in visual acuity common during flight',
                            'Most changes partially reversible within 6 months post-flight'
                        ]),
                        link: 'https://www.ncbi.nlm.nih.gov/pmc/',
                        created_at: new Date().toISOString()
                    },
                    {
                        id: 'demo8',
                        pmcid: 'PMC8924567',
                        title: 'Microbiome Alterations in Closed Space Environments',
                        abstract: 'The human microbiome undergoes significant changes during spaceflight due to altered diet, stress, and the closed environment. This microbiological study analyzed gut microbiome composition, diversity, and function in astronauts.',
                        mission_relevance: 'medium',
                        space_complexity: 5,
                        publication_year: 2023,
                        experiment_duration_days: 120,
                        findings_count: 3,
                        citations_count: 22,
                        relevance_score: 68,
                        biological_systems: JSON.stringify(['Digestive System', 'Immune System']),
                        research_domains: JSON.stringify(['microbiology', 'immunology', 'space_medicine']),
                        key_findings: JSON.stringify([
                            'Microbiome diversity decreased significantly during missions',
                            'Beneficial bacterial species reduced while opportunistic pathogens increased',
                            'Probiotic interventions showed promise for maintaining gut health'
                        ]),
                        link: 'https://www.ncbi.nlm.nih.gov/pmc/',
                        created_at: new Date().toISOString()
                    }
                ];

                document.getElementById('loadingState').style.display = 'none';
                document.getElementById('mainContent').style.display = 'block';

                populateFilters();
                calculateMetrics();
                filteredPublications = [...allPublications];
                filterPublications();
                
                // Show notification
                const notification = document.createElement('div');
                notification.style.cssText = 'position: fixed; top: 80px; right: 20px; background: rgba(59, 130, 246, 0.95); color: white; padding: 16px 24px; border-radius: 12px; box-shadow: 0 8px 24px rgba(0,0,0,0.3); z-index: 1000; max-width: 400px; border: 1px solid rgba(255,255,255,0.2);';
                notification.innerHTML = '‚úÖ Demo data loaded successfully! <br><small style="opacity: 0.9;">Exploring 8 sample NASA publications</small>';
                document.body.appendChild(notification);
                setTimeout(() => notification.remove(), 5000);
            }, 800);
        }

        function parseArray(field) {
            if (!field) return [];
            if (Array.isArray(field)) return field;
            if (typeof field === 'string') {
                try {
                    const parsed = JSON.parse(field);
                    return Array.isArray(parsed) ? parsed : [];
                } catch {
                    return field.split(',').map(s => s.trim()).filter(Boolean);
                }
            }
            return [];
        }

        async function loadPublications() {
            // Check if we should use demo mode
            if (USE_DEMO_MODE) {
                console.log('Demo mode enabled - loading sample data');
                document.getElementById('loadingState').innerHTML = `
                    <div class="spinner"></div>
                    <div>Loading demo publications...</div>
                `;
                setTimeout(loadDemoData, 1000);
                return;
            }

            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/nasa_publications?select=*&order=created_at.desc`, {
                    method: 'GET',
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                        'Content-Type': 'application/json',
                        'Prefer': 'return=representation'
                    },
                    mode: 'cors',
                    cache: 'no-cache'
                });
                
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP ${response.status}: ${errorText || 'Failed to fetch publications'}`);
                }
                
                const data = await response.json();
                allPublications = data;
                
                console.log('Loaded publications:', data.length);

                document.getElementById('loadingState').style.display = 'none';
                document.getElementById('mainContent').style.display = 'block';

                populateFilters();
                calculateMetrics();
                filteredPublications = [...allPublications];
                filterPublications();

            } catch (error) {
                console.error('Error loading publications:', error);
                console.log('Attempting to load demo data as fallback...');
                
                document.getElementById('loadingState').innerHTML = `
                    <div style="color: #fca5a5; max-width: 600px; margin: 0 auto; text-align: left;">
                        <h3 style="margin-bottom: 16px; font-size: 20px;">‚ö†Ô∏è Could Not Connect to Supabase</h3>
                        <p style="margin-bottom: 12px;"><strong>Error:</strong> ${error.message}</p>
                        <div style="background: rgba(59, 130, 246, 0.2); padding: 16px; border-radius: 8px; margin-top: 16px; border: 1px solid rgba(59, 130, 246, 0.4);">
                            <p style="font-size: 14px; margin-bottom: 8px;">üí° <strong>Loading Demo Data Instead</strong></p>
                            <p style="font-size: 13px; opacity: 0.9;">You can explore the dashboard with sample publications while we fix the connection.</p>
                        </div>
                        <div style="background: rgba(255, 255, 255, 0.1); padding: 16px; border-radius: 8px; margin-top: 16px;">
                            <p style="font-size: 14px; margin-bottom: 12px;"><strong>To connect to your Supabase database:</strong></p>
                            <ul style="font-size: 13px; line-height: 1.8; padding-left: 20px;">
                                <li>Verify your Supabase project is active</li>
                                <li>Check RLS policies: Go to Supabase Dashboard ‚Üí Authentication ‚Üí Policies</li>
                                <li>Add a policy for anonymous SELECT access on nasa_publications table</li>
                                <li>Confirm the API key and URL are correct in the code</li>
                                <li>Make sure you're not using file:// protocol (use a local server)</li>
                            </ul>
                        </div>
                        <button onclick="loadDemoData()" class="btn btn-primary" style="margin-top: 20px; border: none;">
                            üìö Continue with Demo Data
                        </button>
                        <button onclick="USE_DEMO_MODE = false; loadPublications();" class="btn btn-secondary" style="margin-top: 20px; margin-left: 12px; border: none;">
                            üîÑ Retry Supabase Connection
                        </button>
                    </div>
                `;
                
                // Auto-load demo data after 3 seconds
                setTimeout(loadDemoData, 3000);
            }
        }

        function populateFilters() {
            const systems = [...new Set(allPublications.flatMap(p => parseArray(p.biological_systems)))];
            const domains = [...new Set(allPublications.flatMap(p => parseArray(p.research_domains)))];
            const years = [...new Set(allPublications.map(p => p.publication_year).filter(Boolean))].sort((a, b) => b - a);

            const systemFilter = document.getElementById('systemFilter');
            systems.forEach(sys => {
                const option = document.createElement('option');
                option.value = sys;
                option.textContent = sys;
                systemFilter.appendChild(option);
            });

            const domainFilter = document.getElementById('domainFilter');
            domains.forEach(domain => {
                const option = document.createElement('option');
                option.value = domain;
                option.textContent = domain.replace(/_/g, ' ');
                domainFilter.appendChild(option);
            });

            const yearFilter = document.getElementById('yearFilter');
            years.forEach(year => {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                yearFilter.appendChild(option);
            });
        }

        function calculateMetrics() {
            const total = allPublications.length;
            const highRel = allPublications.filter(p => p.mission_relevance === 'high').length;
            const avgComp = total > 0 ? (allPublications.reduce((sum, p) => sum + (p.space_complexity || 0), 0) / total).toFixed(1) : 0;
            const totalFind = allPublications.reduce((sum, p) => sum + (p.findings_count || 0), 0);
            const durations = allPublications.filter(p => p.experiment_duration_days);
            const avgDur = durations.length > 0 ? Math.round(durations.reduce((sum, p) => sum + p.experiment_duration_days, 0) / durations.length) : 0;

            document.getElementById('totalPubs').textContent = total;
            document.getElementById('highRelevance').textContent = highRel;
            document.getElementById('avgComplexity').textContent = avgComp;
            document.getElementById('totalFindings').textContent = totalFind;
            document.getElementById('avgDuration').innerHTML = avgDur + '<span style="font-size: 18px;">d</span>';
        }

        function getRelevanceColor(relevance) {
            switch(relevance) {
                case 'high': return 'badge-high';
                case 'medium': return 'badge-medium';
                case 'low': return 'badge-low';
                default: return 'badge-low';
            }
        }

        function getComplexityColor(complexity) {
            if (complexity >= 7) return '#f87171';
            if (complexity >= 4) return '#fbbf24';
            return '#86efac';
        }

        window.debouncedFilter = function() {
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(filterPublications, 300);
        };

        window.filterPublications = function() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const relevance = document.getElementById('relevanceFilter').value;
            const system = document.getElementById('systemFilter').value;
            const domain = document.getElementById('domainFilter').value;
            const year = document.getElementById('yearFilter').value;
            const duration = document.getElementById('durationFilter').value;
            const sort = document.getElementById('sortFilter').value;

            filteredPublications = allPublications.filter(pub => {
                const matchesSearch = !searchTerm || 
                    pub.title?.toLowerCase().includes(searchTerm) ||
                    pub.abstract?.toLowerCase().includes(searchTerm);
                
                const matchesRelevance = relevance === 'all' || pub.mission_relevance === relevance;
                
                const systems = parseArray(pub.biological_systems);
                const matchesSystem = system === 'all' || systems.includes(system);
                
                const domains = parseArray(pub.research_domains);
                const matchesDomain = domain === 'all' || domains.includes(domain);
                
                const matchesYear = year === 'all' || pub.publication_year == year;
                
                let matchesDuration = true;
                if (duration !== 'all' && pub.experiment_duration_days) {
                    if (duration === 'short') matchesDuration = pub.experiment_duration_days <= 30;
                    else if (duration === 'medium') matchesDuration = pub.experiment_duration_days > 30 && pub.experiment_duration_days <= 90;
                    else if (duration === 'long') matchesDuration = pub.experiment_duration_days > 90;
                }

                return matchesSearch && matchesRelevance && matchesSystem && matchesDomain && matchesYear && matchesDuration;
            });

            if (sort === 'relevance') {
                filteredPublications.sort((a, b) => (b.relevance_score || 0) - (a.relevance_score || 0));
            } else if (sort === 'complexity') {
                filteredPublications.sort((a, b) => (b.space_complexity || 0) - (a.space_complexity || 0));
            } else if (sort === 'year') {
                filteredPublications.sort((a, b) => (b.publication_year || 0) - (a.publication_year || 0));
            } else if (sort === 'duration') {
                filteredPublications.sort((a, b) => (b.experiment_duration_days || 0) - (a.experiment_duration_days || 0));
            }

            displayPublications();
        };

        function displayPublications() {
            const container = document.getElementById('publicationsList');
            document.getElementById('resultsCount').textContent = filteredPublications.length;
            document.getElementById('totalCount').textContent = allPublications.length;

            if (filteredPublications.length === 0) {
                container.innerHTML = `
                    <div class="no-results">
                        <div class="no-results-icon">üìö</div>
                        <p style="font-size: 18px;">No publications found matching your filters</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = filteredPublications.map((pub, idx) => {
                const keyFindings = parseArray(pub.key_findings);
                const biologicalSystems = parseArray(pub.biological_systems);
                const researchDomains = parseArray(pub.research_domains);
                const relevanceClass = getRelevanceColor(pub.mission_relevance);
                const complexityColor = getComplexityColor(pub.space_complexity);

                return `
                    <div class="pub-card">
                        <div class="pub-header">
                            <div style="flex: 1;">
                                <div class="pub-badges">
                                    <span class="badge ${relevanceClass}">${(pub.mission_relevance || 'unknown').toUpperCase()}</span>
                                    ${pub.pmcid ? `<span class="badge" style="background: rgba(59, 130, 246, 0.2); color: #93c5fd;">${pub.pmcid}</span>` : ''}
                                    ${pub.publication_year ? `<span class="badge" style="background: rgba(156, 163, 175, 0.2); color: #d1d5db;">üìÖ ${pub.publication_year}</span>` : ''}
                                    ${pub.experiment_duration_days ? `<span class="badge" style="background: rgba(156, 163, 175, 0.2); color: #d1d5db;">${pub.experiment_duration_days} days</span>` : ''}
                                </div>
                                <div class="pub-title">${pub.title || 'Untitled'}</div>
                                <div class="pub-abstract">${(pub.abstract || 'No abstract available.').substring(0, 200)}${pub.abstract?.length > 200 ? '...' : ''}</div>
                            </div>
                            <button class="expand-btn" onclick="toggleDetails(${idx})">
                                <span id="expandIcon${idx}">‚ñº</span>
                            </button>
                        </div>

                        <div class="pub-meta">
                            <div class="meta-item">
                                <span>üß†</span>
                                <span>Complexity:</span>
                                <strong style="color: ${complexityColor};">${pub.space_complexity || 0}/10</strong>
                            </div>
                            <div class="meta-item">
                                <span>üìö</span>
                                <span>Findings:</span>
                                <strong>${keyFindings.length}</strong>
                            </div>
                            ${pub.citations_count > 0 ? `
                            <div class="meta-item">
                                <span>üèÜ</span>
                                <span>Citations:</span>
                                <strong>${pub.citations_count}</strong>
                            </div>
                            ` : ''}
                        </div>

                        ${biologicalSystems.length > 0 ? `
                        <div class="systems-tags">
                            ${biologicalSystems.map(sys => `<span class="system-tag">${sys}</span>`).join('')}
                        </div>
                        ` : ''}

                        <div class="pub-details" id="details${idx}">
                            ${keyFindings.length > 0 ? `
                            <div class="findings-section">
                                <h4>Key Findings</h4>
                                <ol class="findings-list">
                                    ${keyFindings.map((finding, i) => `
                                        <li>
                                            <span class="finding-number">${i + 1}.</span>
                                            <span>${finding}</span>
                                        </li>
                                    `).join('')}
                                </ol>
                            </div>
                            ` : ''}

                            ${pub.ai_response ? `
                            <div class="ai-analysis">
                                <h4>AI Analysis</h4>
                                <div class="ai-content">
                                    ${pub.ai_response.split('\n').map(line => {
                                        const parts = line.split(/\*\*(.*?)\*\*/g);
                                        return `<p>${parts.map((part, i) => 
                                            i % 2 === 1 ? `<strong>${part}</strong>` : part
                                        ).join('')}</p>`;
                                    }).join('')}
                                </div>
                            </div>
                            ` : ''}

                            ${researchDomains.length > 0 ? `
                            <div class="domains-section">
                                <h4>Research Domains</h4>
                                <div class="domain-tags">
                                    ${researchDomains.map(domain => `
                                        <span class="domain-tag">${domain.replace(/_/g, ' ')}</span>
                                    `).join('')}
                                </div>
                            </div>
                            ` : ''}

                            ${pub.link ? `
                            <a href="${pub.link}" target="_blank" rel="noopener noreferrer" class="btn btn-primary" style="display: inline-flex; text-decoration: none; margin-top: 16px;">
                                <span>üîó</span>
                                View Full Publication
                            </a>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        window.toggleDetails = function(idx) {
            const details = document.getElementById(`details${idx}`);
            const icon = document.getElementById(`expandIcon${idx}`);
            
            if (details.classList.contains('active')) {
                details.classList.remove('active');
                icon.textContent = '‚ñº';
            } else {
                details.classList.add('active');
                icon.textContent = '‚ñ≤';
            }
        };

        window.toggleAdvancedFilters = function() {
            const advanced = document.getElementById('advancedFilters');
            const toggleText = document.getElementById('advancedToggleText');
            
            if (advanced.classList.contains('active')) {
                advanced.classList.remove('active');
                toggleText.textContent = 'Show Advanced';
            } else {
                advanced.classList.add('active');
                toggleText.textContent = 'Hide Advanced';
            }
        };

        window.toggleTheme = function() {
            const body = document.body;
            const icon = document.getElementById('themeIcon');
            
            if (body.classList.contains('light-mode')) {
                body.classList.remove('light-mode');
                icon.textContent = 'üåô';
                localStorage.setItem('theme', 'dark');
            } else {
                body.classList.add('light-mode');
                icon.textContent = '‚òÄÔ∏è';
                localStorage.setItem('theme', 'light');
            }
        };

        window.exportData = function() {
            const csv = [
                ['Title', 'PMCID', 'Relevance', 'Complexity', 'Year', 'Duration', 'Findings'],
                ...filteredPublications.map(pub => [
                    `"${(pub.title || '').replace(/"/g, '""')}"`,
                    pub.pmcid || '',
                    pub.mission_relevance || '',
                    pub.space_complexity || '',
                    pub.publication_year || '',
                    pub.experiment_duration_days || '',
                    pub.findings_count || ''
                ])
            ].map(row => row.join(',')).join('\n');

            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'nasa_publications.csv';
            a.click();
            URL.revokeObjectURL(url);
        };

        window.triggerProcessing = async function() {
            if (processing) return;
            
            processing = true;
            const btn = document.getElementById('processBtn');
            btn.innerHTML = '<span class="spinner" style="width: 16px; height: 16px; border-width: 2px; margin: 0;"></span> Processing...';
            btn.disabled = true;

            try {
                await fetch(N8N_WEBHOOK_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                setTimeout(() => {
                    loadPublications();
                    processing = false;
                    btn.innerHTML = '<span>üîÑ</span> Process New Data';
                    btn.disabled = false;
                }, 5000);
            } catch (error) {
                console.error('Error triggering processing:', error);
                processing = false;
                btn.innerHTML = '<span>üîÑ</span> Process New Data';
                btn.disabled = false;
            }
        };

        window.setViewMode = function(mode) {
            const btns = document.querySelectorAll('.view-btn');
            btns.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        };

        function add3DCardEffect() {
            const cards = document.querySelectorAll('.developer-card');
            const maxRotate = 15;

            cards.forEach(card => {
                card.addEventListener('mousemove', (e) => {
                    const rect = card.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;
                    const { width, height } = rect;
                    
                    const rotateX = maxRotate * ((y / height) - 0.5) * -1;
                    const rotateY = maxRotate * ((x / width) - 0.5);

                    card.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale(1.05)`;
                    card.style.transition = 'none';
                });

                card.addEventListener('mouseleave', () => {
                    card.style.transition = 'all 0.3s ease-out';
                    card.style.transform = 'perspective(1000px) rotateX(0deg) rotateY(0deg) scale(1)';
                });
            });
        }

        document.addEventListener('DOMContentLoaded', async () => {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'light') {
                document.body.classList.add('light-mode');
                document.getElementById('themeIcon').textContent = '‚òÄÔ∏è';
            }
            
            // Test connection first
            console.log('Testing Supabase connection...');
            const connected = await testConnection();
            console.log('Connection status:', connected);
            
            loadPublications();
            setTimeout(add3DCardEffect, 1000);
        });
    </script>
</body>
</html>
